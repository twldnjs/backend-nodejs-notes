# 데이터베이스 기초 (DBMS / RDBMS / 정규화 / 키 / 관계)

## 데이터베이스란?

- 데이터를 통합하여 효율적으로 관리하기 위한 데이터 집합체
- 데이터를 구조화 하여 관리함으로써 데이터 중복을 막고, 효율적으로 빠른 데이터 연산을 가능하게 한다.

---

# DBMS 와 RDBMS

## DBMS (Database Management System)

데이터베이스를 운영하고 관리하기 위한 시스템

- 운영 회사는 다르지만, 데이터베이스에 연산을 요청하기 위해 **SQL**이라는 표준 언어 사용
- **주요 DBMS**
  - Oracle Database
  - MySQL
  - MariaDB
  - PostgreSQL
  - Microsoft SQL Server
  - MongoDB (NoSQL)

- **기능**
  - 데이터 정의(DDL): CREATE, ALTER, DROP
  - 데이터 조작(DML): SELECT, INSERT, UPDATE, DELETE
  - 데이터 제어(DCL): GRANT, REVOKE
  - 트랜잭션 관리(TCL): COMMIT, ROLLBACK

## RDBMS

관계형 데이터베이스 관리 시스템

### RDBMS를 사용하는 이유

1. 테이블 분리 : 데이터를 여러 테이블로 나눠 저장
2. 관계 설정 : 테이블들을 **PK/FK로 연결(관계)**
3. **JOIN 활용**: 필요할 때 여러 테이블을 합쳐서 조회
4. → 그 결과 : **중복이 줄고**, **수정/삭제/추가가 안전**해지고, **데이터 일관성**이 좋아진다.

---

# 키(key) 개념

## PK **(Primary Key ,기본키)**

해당 테이블의 각 행 (row) 을 유니크(=유일)하게 구별할 수 있는 키

- 예: users 테이블의 user_id(숫자), 또는 email(문자) 중 하나를 PK로 선정
- PK 조건
  - 중복 불가 (UNIQUE)
  - NULL 불가 (NOT NULL)
  - 가능하면 변하지 않는 값 (불변성)
  - 가능하면 단순한 값 (정수형 권장)

## FK (Foreign Key, 외래키)

A 테이블에서 B 테이블의 데이터를 찾아가고 싶을 때 사용하는 key 값

- **다른 테이블의 PK를 참조하는 키**
- 목적 : 테이블 간 관계를 설정하고 참조 무결성 유지
  - 예: `channels` 테이블의 `user_id`는 `users(user_id)`를 가리키는 FK
  - FK는 “관계 연결선”으로, “이 채널의 주인은 users 테이블의 누구?”를 찾을 수 있게 해줌.
- 특징 : FK는 Null 값을 가질 수 있음 (선택적 관계)
- FK 값은 참조하는 테이블의 PK에 존재해야 함(참조 무결성)

---

# 정규화와 테이블 설계

## 데이터 중복의 문제점

### 이상(Anomaly) 현상

1. 갱신 이상
   1. 중복된 데이터 중 일부만 수정되어 데이터 불일치 발생
   2. 예: 사용자의 연락처가 바뀌었는데 일부 레코드만 수정됨
2. 삽입 이상
   1. 불필요한 데이터를 함께 입력하지 않으면 원하는 데이터를 저장할 수 없음
   2. 예 : 게시글이 없으면 사용자 정보를 등록할 수 없는 구조
3. 삭제 이상
   1. 필요한 데이터를 삭제하면 원하지 않는 다른 데이터까지 삭제됨
   2. 예: 마지막 게시글을 삭제했더니 사용자 정보까지 사라짐

## 정규화 (Normalization)

- 중복을 없애고 관계로 연결하는 데이터베이스 설계 기법
- 목적 : 이상 현상 제거, 데이터 무결성 유지, 저장 공간 효율화
- → 자주 반복되는 속성(사용자 정보 같은 것)을 별도 테이블로 빼고, FK로 연결하는 것

---

# 관계 이해하기

## 관계의 종류

### 1:1 (일대일 관계)

- 한 테이블의 레코드가 다른 테이블의 정확히 한 레코드와 연결
- 예 : 사용자 ↔ 사용자 상세 정보
- 양쪽 모두 FK 로 참조하거나, 한쪽에만 FK 설정
- 사용 사례
  - 보안상 민감한 정보 분리 → 예: 사용자 기본정보 ↔ 사용자 보안정보
  - 선택적 정보 분리 → 예: 사용자 ↔ 프리미엄 회원 정보

### 1:N (일대다) 관계 ★ 가장 흔함

- 한 테이블의 레코드가 다른 테이블의 여러 레코드와 연결
- 예 :
  - 사용자(1) ↔ 게시글(N): 한 사용자가 여러 게시글 작성
  - 사용자(1) ↔ 채널(N): 한 사용자가 여러 채널 소유
- **구현** : "다(N)" 쪽에 FK 설정
  - `posts.user_id` → `users.user_id` (FK)
- **방향성** :
  - N → 1 방향 참조 가능: 게시글에서 사용자 찾기
  - 1 → N 방향 직접 참조 불가: 사용자에서 게시글 찾기는 쿼리로 처리

```sql
-- 사용자의 모든 게시글 조회 (1 → N)
SELECT * FROM posts WHERE user_id = 1;

-- 게시글의 작성자 정보 조회 (N → 1)
SELECT u.* FROM users u
JOIN posts p ON u.user_id = p.user_id
WHERE p.post_id = 10;
```

### M:N (다대다) 관계

- 양쪽 테이블의 레코드가 여러 레코드와 연결 가능
- 예 :
  - 학생 ↔ 수강과목 : 한 학생이 여러 과목 수강, 한 과목을 여러 학생이 수강
  - 사용자 ↔ 관심 카테고리
- 구현 : 중간 테이블(연결 테이블, Junction Table) 사용
  - 1:N + N:1로 분리

```sql
-- M:N 관계를 1:N + N:1로 분리
-- 학생 테이블
students (student_id PK, name, ...)

-- 과목 테이블
courses (course_id PK, course_name, ...)

-- 수강 테이블 (중간 테이블)
enrollments (
    enrollment_id PK,
    student_id FK → students,
    course_id FK → courses,
    grade, enrollment_date
)
```

### 관계의 주인(Owner)

- **FK를 가진 쪽**이 관계의 주인
- 관계의 주인만 상대 테이블을 직접 참조 가능
- 예 :
  - `posts` 테이블이 `user_id(FK)`를 가짐 → posts가 관계의 주인
  - posts에서 users 찾기: 가능
  - users에서 posts 찾기: WHERE 조건으로 별도 쿼리 필요

### 참조 무결성(Referential Integrity)

- FK가 참조하는 PK는 반드시 존재해야 함
- **제약 조건 옵션**:

```sql
FOREIGN KEY (user_id) REFERENCES users(user_id)
      ON DELETE CASCADE      -- 부모 삭제 시 자식도 삭제
      ON DELETE SET NULL     -- 부모 삭제 시 자식의 FK를 NULL로
      ON DELETE RESTRICT     -- 자식이 있으면 부모 삭제 불가
      ON UPDATE CASCADE      -- 부모 PK 변경 시 자식 FK도 변경
```
